{% extends "base.html" %}
{% block body %}

    <h1> Dashboard</h1>

    <div class="sub-nav">
        <ul>
            <li><a href="/review/"> General </a></li>
            <li><a href="/review/food"> Food </a></li>
            <li><a href="/review/server"> Server </a></li>
        <ul>
    </div>

    
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

	<h2> General Analysis </h2>
    
    <div id="daily_rating"></div>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load('visualization', '1');   // Don't need to specify chart libraries!
      google.setOnLoadCallback(drawVisualization);

      function drawVisualization() {
        var wrapper = new google.visualization.ChartWrapper({
          chartType: 'ColumnChart',
          dataTable: [['', '1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                      ['', {{star_count[1]}}, {{star_count[2]}}, {{star_count[3]}}, {{star_count[4]}}, {{star_count[5]}}]],
          options: {'title': ''},
          containerId: 'daily_rating'
        });

        wrapper.draw();
        google.visualization.events.addListener(wrapper, 'ready', onReady);
        function onReady() {
          google.visualization.events.addListener(wrapper, 'select', selectHandler);
        }
        var oTable = $('#datatable').dataTable();
        function selectHandler() {
          var selectedItem = wrapper.getChart().getSelection()[0];
          if (selectedItem) {
            oTable.fnFilter(selectedItem.column, 0);
          }
        }
      }
    </script>

<h1>Comments</h1>


<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="//cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>

<link rel="stylesheet" href="//cdn.datatables.net/1.10.2/css/jquery.dataTables.css">

<style> 
    span.stars, span.stars span {
        display: block;
        background: url("/static/star.png") 0 -16px repeat-x;
        width: 80px;
        height: 16px;
    }

    span.stars span {
        background-position: 0 0;
    }

    .hidden {
        display: none;
    }
</style>

<script>
    $.fn.stars = function() {
        return $(this).each(function() {
            $(this).html($('<span />').width(Math.max(0, (Math.min(5, parseFloat($(this).html())))) * 16));
        });

    }

    $(function() {
        $('span.stars').stars();
    });
</script>
<table class="table table-striped compact" id="datatable">
  <thead>
    <tr>
      <th>Stars</th>
      <th>Comment</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody>
    {% for review in reviews %}
      <tr>
        <td><span class="hidden">{{review.stars}}</span><span class="stars">{{review.stars}}</span></td>
        <td>{{review.comment}}</td>
        <td>{{review.created_at.date()}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
